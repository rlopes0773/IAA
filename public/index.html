<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifiable Credentials Demo - Multi Management</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1400px; margin: 0 auto; padding: 20px; }
        .container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .full-width { grid-column: 1 / -1; }
        .section { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .section h2 { color: #333; margin-top: 0; }
        button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 3px; font-size: 12px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .json-output { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; font-family: monospace; font-size: 11px; max-height: 300px; overflow-y: auto; }
        .item-list { max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; }
        .item { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; position: relative; }
        .item:hover { background: #f8f9fa; }
        .item.selected { background: #e3f2fd; border-left: 4px solid #2196f3; }
        .item-header { font-weight: bold; color: #333; }
        .item-meta { font-size: 12px; color: #666; margin-top: 4px; }
        .item-actions { position: absolute; right: 10px; top: 10px; }
        .checkbox-container { display: flex; align-items: center; gap: 8px; }
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        .tab { padding: 10px 20px; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom: 2px solid #007bff; background: #f8f9fa; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .success { border-left: 4px solid #28a745; background: #d4edda; }
        .error { border-left: 4px solid #dc3545; background: #f8d7da; }
        .warning { border-left: 4px solid #ffc107; background: #fff3cd; }
        .step { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .step-number { background: #007bff; color: white; border-radius: 50%; width: 25px; height: 25px; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; }
        .counter { background: #17a2b8; color: white; border-radius: 12px; padding: 2px 8px; font-size: 12px; margin-left: 8px; }
    </style>
</head>
<body>
    <h1>üéì Verifiable Credentials Demo - Multi Management</h1>
    <p>Gerencie m√∫ltiplas credenciais e apresenta√ß√µes verific√°veis</p>

    <div class="container">
        <!-- ISSUER SECTION -->
        <div class="section">
            <h2>üèõÔ∏è Issuer (Emissor) <span id="credentialCounter" class="counter">0</span></h2>
            <div class="step">
                <span class="step-number">1</span>
                <strong>Criar Credenciais Verific√°veis</strong>
            </div>
            
            <label>Subject DID:</label>
            <input type="text" id="subject" value="did:example:student123">
            
            <label>Tipo de Credencial:</label>
            <select id="credentialType" onchange="updateCredentialFields()">
                <option value="UniversityDegree">University Degree</option>
                <option value="DriverLicense">Driver License</option>
                <option value="Certificate">Certificate</option>
            </select>
            
            <div id="dynamicFields"></div>
            
            <button onclick="issueCredential()">üîê Emitir Credencial</button>
            <button onclick="loadCredentials()" class="success">üîÑ Atualizar Lista</button>
            
            <h3>Credenciais Criadas:</h3>
            <div id="credentialsList" class="item-list"></div>
        </div>

        <!-- HOLDER SECTION -->
        <div class="section">
            <h2>üë§ Holder (Portador) <span id="presentationCounter" class="counter">0</span></h2>
            <div class="step">
                <span class="step-number">2</span>
                <strong>Criar Apresenta√ß√µes Verific√°veis</strong>
            </div>
            
            <label>Holder DID:</label>
            <input type="text" id="holderDid" value="did:example:holder123">
            
            <label>Challenge:</label>
            <input type="text" id="challenge" value="demo-challenge-123">
            
            <h3>Selecionar Credenciais:</h3>
            <div id="credentialsForSelection" class="item-list" style="max-height: 200px;"></div>
            
            <button onclick="createPresentation()" id="presentBtn">üìÑ Criar Apresenta√ß√£o</button>
            <button onclick="loadPresentations()" class="success">üîÑ Atualizar Lista</button>
            
            <h3>Apresenta√ß√µes Criadas:</h3>
            <div id="presentationsList" class="item-list"></div>
        </div>
    </div>

    <!-- VERIFIER & REVOCATION SECTION -->
    <div class="full-width">
        <div class="section">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('verify')">‚úÖ Verifier</div>
                <div class="tab" onclick="switchTab('revoke')">‚ùå Revocation</div>
            </div>

            <!-- VERIFY TAB -->
            <div id="verifyTab" class="tab-content active">
                <h2>‚úÖ Verifier (Verificador)</h2>
                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Verificar Apresenta√ß√µes</strong>
                </div>
                
                <h3>Selecionar Apresenta√ß√£o para Verificar:</h3>
                <div id="presentationsForVerification" class="item-list"></div>
                
                <button onclick="verifySelectedPresentation()" id="verifyBtn">üîç Verificar Apresenta√ß√£o</button>
                
                <div id="verificationOutput" class="json-output" style="display:none;"></div>
            </div>

            <!-- REVOKE TAB -->
            <div id="revokeTab" class="tab-content">
                <h2>‚ùå Revocation Registry</h2>
                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Revogar e Verificar Status</strong>
                </div>
                
                <h3>Selecionar Apresenta√ß√£o para Revogar:</h3>
                <div id="presentationsForRevocation" class="item-list"></div>
                
                <button onclick="revokeSelectedPresentation()" id="revokeBtn" class="danger">üö´ Revogar Apresenta√ß√£o</button>
                <button onclick="checkSelectedRevocation()" id="checkBtn">üìã Verificar Status</button>
                
                <div id="revocationOutput" class="json-output" style="display:none;"></div>
            </div>
        </div>
    </div>

    <!-- STORAGE MANAGEMENT SECTION -->
    <div class="full-width">
        <div class="section">
            <h2>üíæ Gest√£o de Armazenamento</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="font-size: 24px; font-weight: bold; color: #007bff;" id="storageCredentials">-</div>
                    <div>Credenciais em Ficheiros</div>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="font-size: 24px; font-weight: bold; color: #28a745;" id="storagePresentations">-</div>
                    <div>Apresenta√ß√µes em Ficheiros</div>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="font-size: 24px; font-weight: bold; color: #6c757d;" id="storageSize">-</div>
                    <div>Tamanho Total</div>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button onclick="loadStorageStats()" class="success">üìä Atualizar Estat√≠sticas</button>
                <button onclick="createBackup()" style="background: #17a2b8;">üíæ Criar Backup</button>
                <button onclick="showFileLocations()" style="background: #6c757d;">üìÅ Mostrar Localiza√ß√µes</button>
            </div>
            
            <div id="storageInfo" style="display:none; margin-top: 20px;" class="json-output"></div>
        </div>
    </div>

    <script>
        let credentials = [];
        let presentations = [];
        let selectedCredentials = new Set();
        let selectedPresentationForVerify = null;
        let selectedPresentationForRevoke = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            updateCredentialFields();
            loadCredentials();
            loadPresentations();
            loadStorageStats();
        });

        function switchTab(tabName) {
            // Remover active de todas as tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Ativar tab selecionada
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Atualizar listas conforme necess√°rio
            if (tabName === 'verify') {
                updatePresentationsForVerification();
            } else if (tabName === 'revoke') {
                updatePresentationsForRevocation();
            }
        }

        function updateCredentialFields() {
            const type = document.getElementById('credentialType').value;
            const dynamicFields = document.getElementById('dynamicFields');
            
            switch(type) {
                case 'UniversityDegree':
                    dynamicFields.innerHTML = `
                        <label>Degree:</label>
                        <input type="text" id="degree" placeholder="Bachelor of Science">
                        
                        <label>University:</label>
                        <input type="text" id="university" placeholder="MIT">
                        
                        <label>Major:</label>
                        <input type="text" id="major" placeholder="Computer Science">
                        
                        <label>GPA:</label>
                        <input type="number" id="gpa" placeholder="3.8" step="0.1" min="0" max="4">
                    `;
                    break;
                    
                case 'DriverLicense':
                    dynamicFields.innerHTML = `
                        <label>License Class:</label>
                        <select id="licenseClass">
                            <option value="A">Class A</option>
                            <option value="B">Class B</option>
                            <option value="C">Class C</option>
                        </select>
                        
                        <label>Issuing State:</label>
                        <input type="text" id="issuingState" placeholder="CA">
                        
                        <label>Date of Birth:</label>
                        <input type="date" id="dateOfBirth">
                    `;
                    break;
                    
                case 'Certificate':
                    dynamicFields.innerHTML = `
                        <label>Certificate Name:</label>
                        <input type="text" id="certificateName" placeholder="AWS Solutions Architect">
                        
                        <label>Certification Level:</label>
                        <select id="certificationLevel">
                            <option value="Basic">Basic</option>
                            <option value="Professional">Professional</option>
                            <option value="Expert">Expert</option>
                        </select>
                        
                        <label>Skills (comma separated):</label>
                        <input type="text" id="skillsValidated" placeholder="Cloud Architecture, AWS, DevOps">
                    `;
                    break;
            }
        }

        async function issueCredential() {
            const subject = document.getElementById('subject').value;
            const type = document.getElementById('credentialType').value;
            
            let additionalData = { subject, type };
            
            switch(type) {
                case 'UniversityDegree':
                    additionalData = {
                        ...additionalData,
                        degree: document.getElementById('degree')?.value,
                        university: document.getElementById('university')?.value,
                        major: document.getElementById('major')?.value,
                        gpa: parseFloat(document.getElementById('gpa')?.value) || null
                    };
                    break;
                    
                case 'DriverLicense':
                    additionalData = {
                        ...additionalData,
                        licenseClass: document.getElementById('licenseClass')?.value,
                        issuingState: document.getElementById('issuingState')?.value,
                        dateOfBirth: document.getElementById('dateOfBirth')?.value
                    };
                    break;
                    
                case 'Certificate':
                    const skills = document.getElementById('skillsValidated')?.value;
                    additionalData = {
                        ...additionalData,
                        certificateName: document.getElementById('certificateName')?.value,
                        certificationLevel: document.getElementById('certificationLevel')?.value,
                        skillsValidated: skills ? skills.split(',').map(s => s.trim()) : []
                    };
                    break;
            }

            try {
                const response = await fetch('/issue', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(additionalData)
                });

                const credential = await response.json();
                
                showSuccess('Credencial criada com sucesso!');
                loadCredentials();
                
                // Limpar campos
                document.querySelectorAll('#dynamicFields input, #dynamicFields select').forEach(input => {
                    if (input.type !== 'date') input.value = '';
                });
                
            } catch (error) {
                showError('Erro ao criar credencial: ' + error.message);
            }
        }

        async function loadCredentials() {
            try {
                const response = await fetch('/credentials');
                credentials = await response.json();
                
                document.getElementById('credentialCounter').textContent = credentials.length;
                updateCredentialsList();
                updateCredentialsForSelection();
                
            } catch (error) {
                console.error('Erro ao carregar credenciais:', error);
            }
        }

        function updateCredentialsList() {
            const container = document.getElementById('credentialsList');
            
            if (credentials.length === 0) {
                container.innerHTML = '<div class="item">Nenhuma credencial criada ainda.</div>';
                return;
            }
            
            container.innerHTML = credentials.map(cred => `
                <div class="item">
                    <div class="item-header">${cred.preview.type}</div>
                    <div class="item-meta">
                        Subject: ${cred.preview.subject}<br>
                        Issued: ${new Date(cred.preview.issuanceDate).toLocaleDateString()}
                    </div>
                    <div class="item-actions">
                        <button onclick="viewCredential('${cred.id}')" style="font-size: 10px;">üëÅÔ∏è Ver</button>
                        <button onclick="deleteCredential('${cred.id}')" class="danger" style="font-size: 10px;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function updateCredentialsForSelection() {
            const container = document.getElementById('credentialsForSelection');
            
            if (credentials.length === 0) {
                container.innerHTML = '<div class="item">Nenhuma credencial dispon√≠vel para sele√ß√£o.</div>';
                return;
            }
            
            container.innerHTML = credentials.map(cred => `
                <div class="item">
                    <div class="checkbox-container">
                        <input type="checkbox" id="cred_${cred.id}" onchange="toggleCredentialSelection('${cred.id}')" 
                               ${selectedCredentials.has(cred.id) ? 'checked' : ''}>
                        <label for="cred_${cred.id}">
                            <strong>${cred.preview.type}</strong><br>
                            <span style="font-size: 12px; color: #666;">${cred.preview.subject}</span>
                        </label>
                    </div>
                </div>
            `).join('');
        }

        function toggleCredentialSelection(credentialId) {
            if (selectedCredentials.has(credentialId)) {
                selectedCredentials.delete(credentialId);
            } else {
                selectedCredentials.add(credentialId);
            }
        }

        async function createPresentation() {
            if (selectedCredentials.size === 0) {
                showError('Selecione pelo menos uma credencial para criar a apresenta√ß√£o.');
                return;
            }

            const holderDid = document.getElementById('holderDid').value;
            const challenge = document.getElementById('challenge').value;

            try {
                const response = await fetch('/present', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentialIds: Array.from(selectedCredentials),
                        challenge,
                        holderDid
                    })
                });

                const presentation = await response.json();
                
                showSuccess(`Apresenta√ß√£o criada com ${selectedCredentials.size} credencial(is)!`);
                
                // Limpar sele√ß√µes
                selectedCredentials.clear();
                updateCredentialsForSelection();
                
                loadPresentations();
                
            } catch (error) {
                showError('Erro ao criar apresenta√ß√£o: ' + error.message);
            }
        }

        async function loadPresentations() {
            try {
                const response = await fetch('/presentations');
                presentations = await response.json();
                
                document.getElementById('presentationCounter').textContent = presentations.length;
                updatePresentationsList();
                updatePresentationsForVerification();
                updatePresentationsForRevocation();
                
            } catch (error) {
                console.error('Erro ao carregar apresenta√ß√µes:', error);
            }
        }

        function updatePresentationsList() {
            const container = document.getElementById('presentationsList');
            
            if (presentations.length === 0) {
                container.innerHTML = '<div class="item">Nenhuma apresenta√ß√£o criada ainda.</div>';
                return;
            }
            
            container.innerHTML = presentations.map(pres => `
                <div class="item">
                    <div class="item-header">Apresenta√ß√£o (${pres.preview.credentialCount} creds)</div>
                    <div class="item-meta">
                        Holder: ${pres.preview.holder}<br>
                        Created: ${new Date(pres.preview.created).toLocaleDateString()}
                    </div>
                    <div class="item-actions">
                        <button onclick="viewPresentation('${pres.id}')" style="font-size: 10px;">üëÅÔ∏è Ver</button>
                        <button onclick="deletePresentation('${pres.id}')" class="danger" style="font-size: 10px;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function updatePresentationsForVerification() {
            const container = document.getElementById('presentationsForVerification');
            
            if (presentations.length === 0) {
                container.innerHTML = '<div class="item">Nenhuma apresenta√ß√£o dispon√≠vel para verifica√ß√£o.</div>';
                return;
            }
            
            container.innerHTML = presentations.map(pres => `
                <div class="item ${selectedPresentationForVerify === pres.id ? 'selected' : ''}" 
                     onclick="selectPresentationForVerify('${pres.id}')">
                    <div class="item-header">Apresenta√ß√£o (${pres.preview.credentialCount} creds)</div>
                    <div class="item-meta">
                        Holder: ${pres.preview.holder}<br>
                        ID: ${pres.id}
                    </div>
                </div>
            `).join('');
        }

        function updatePresentationsForRevocation() {
            const container = document.getElementById('presentationsForRevocation');
            
            if (presentations.length === 0) {
                container.innerHTML = '<div class="item">Nenhuma apresenta√ß√£o dispon√≠vel para revoga√ß√£o.</div>';
                return;
            }
            
            container.innerHTML = presentations.map(pres => `
                <div class="item ${selectedPresentationForRevoke === pres.id ? 'selected' : ''}" 
                     onclick="selectPresentationForRevoke('${pres.id}')">
                    <div class="item-header">Apresenta√ß√£o (${pres.preview.credentialCount} creds)</div>
                    <div class="item-meta">
                        Holder: ${pres.preview.holder}<br>
                        ID: ${pres.id}
                    </div>
                </div>
            `).join('');
        }

        function selectPresentationForVerify(presentationId) {
            selectedPresentationForVerify = presentationId;
            updatePresentationsForVerification();
        }

        function selectPresentationForRevoke(presentationId) {
            selectedPresentationForRevoke = presentationId;
            updatePresentationsForRevocation();
        }

        async function verifySelectedPresentation() {
            if (!selectedPresentationForVerify) {
                showError('Selecione uma apresenta√ß√£o para verificar.');
                return;
            }

            try {
                const response = await fetch(`/verify/${selectedPresentationForVerify}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                
                document.getElementById('verificationOutput').style.display = 'block';
                document.getElementById('verificationOutput').innerHTML = `
                    <div class="step ${result.verified ? 'success' : 'error'}">
                        <strong>${result.verified ? '‚úÖ Apresenta√ß√£o V√ÅLIDA' : '‚ùå Apresenta√ß√£o INV√ÅLIDA'}</strong><br>
                        ID: ${selectedPresentationForVerify}<br>
                        Revogada: ${result.revoked ? 'Sim' : 'N√£o'}
                    </div>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                showError('Erro ao verificar apresenta√ß√£o: ' + error.message);
            }
        }

        async function revokeSelectedPresentation() {
            if (!selectedPresentationForRevoke) {
                showError('Selecione uma apresenta√ß√£o para revogar.');
                return;
            }

            try {
                const response = await fetch(`/revoke/${selectedPresentationForRevoke}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                
                document.getElementById('revocationOutput').style.display = 'block';
                document.getElementById('revocationOutput').innerHTML = `
                    <div class="step warning">
                        <strong>üö´ Apresenta√ß√£o revogada!</strong><br>
                        ID: ${result.presentationId}
                    </div>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
                
                showSuccess('Apresenta√ß√£o revogada com sucesso!');
                
            } catch (error) {
                showError('Erro ao revogar apresenta√ß√£o: ' + error.message);
            }
        }

        async function checkSelectedRevocation() {
            if (!selectedPresentationForRevoke) {
                showError('Selecione uma apresenta√ß√£o para verificar o status.');
                return;
            }

            try {
                const response = await fetch(`/check-revocation/${selectedPresentationForRevoke}`);
                const result = await response.json();
                
                const output = document.getElementById('revocationOutput');
                output.style.display = 'block';
                output.innerHTML += `
                    <div class="step ${result.revoked ? 'warning' : 'success'}">
                        <strong>üìã Status: ${result.revoked ? 'REVOGADA' : 'ATIVA'}</strong><br>
                        ID: ${result.presentationId}
                    </div>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                showError('Erro ao verificar status: ' + error.message);
            }
        }

        async function viewCredential(credentialId) {
            try {
                const response = await fetch(`/credentials/${credentialId}`);
                const credential = await response.json();
                
                showModal('Credencial', JSON.stringify(credential, null, 2));
            } catch (error) {
                showError('Erro ao carregar credencial: ' + error.message);
            }
        }

        async function viewPresentation(presentationId) {
            try {
                const response = await fetch(`/presentations/${presentationId}`);
                const presentation = await response.json();
                
                showModal('Apresenta√ß√£o', JSON.stringify(presentation, null, 2));
            } catch (error) {
                showError('Erro ao carregar apresenta√ß√£o: ' + error.message);
            }
        }

        async function deleteCredential(credentialId) {
            if (!confirm('Tem certeza que deseja deletar esta credencial?')) return;

            try {
                const response = await fetch(`/credentials/${credentialId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showSuccess('Credencial deletada com sucesso!');
                    loadCredentials();
                } else {
                    showError('Erro ao deletar credencial.');
                }
            } catch (error) {
                showError('Erro ao deletar credencial: ' + error.message);
            }
        }

        async function deletePresentation(presentationId) {
            if (!confirm('Tem certeza que deseja deletar esta apresenta√ß√£o?')) return;

            try {
                const response = await fetch(`/presentations/${presentationId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showSuccess('Apresenta√ß√£o deletada com sucesso!');
                    loadPresentations();
                } else {
                    showError('Erro ao deletar apresenta√ß√£o.');
                }
            } catch (error) {
                showError('Erro ao deletar apresenta√ß√£o: ' + error.message);
            }
        }

        function showSuccess(message) {
            // Simples implementa√ß√£o de toast/notifica√ß√£o
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1000;
                background: #28a745; color: white; padding: 15px; border-radius: 4px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }

        function showError(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1000;
                background: #dc3545; color: white; padding: 15px; border-radius: 4px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 5000);
        }

        function showModal(title, content) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000;
                background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; max-width: 80%; max-height: 80%; overflow: auto;">
                    <h3>${title}</h3>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow: auto;">${content}</pre>
                    <button onclick="this.closest('[style*=fixed]').remove()" style="margin-top: 10px;">Fechar</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // STORAGE MANAGEMENT FUNCTIONS

        async function loadStorageStats() {
            try {
                const response = await fetch('/storage/stats');
                const stats = await response.json();
                
                document.getElementById('storageCredentials').textContent = stats.credentials;
                document.getElementById('storagePresentations').textContent = stats.presentations;
                document.getElementById('storageSize').textContent = stats.totalSize;
                
                showSuccess('Estat√≠sticas atualizadas!');
            } catch (error) {
                showError('Erro ao carregar estat√≠sticas: ' + error.message);
            }
        }

        async function createBackup() {
            try {
                const response = await fetch('/storage/backup', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('storageInfo').style.display = 'block';
                    document.getElementById('storageInfo').innerHTML = `
                        <div class="step success">
                            <strong>‚úÖ Backup criado com sucesso!</strong><br>
                            Localiza√ß√£o: ${result.backupPath}
                        </div>
                    `;
                    showSuccess('Backup criado com sucesso!');
                } else {
                    showError('Erro ao criar backup.');
                }
            } catch (error) {
                showError('Erro ao criar backup: ' + error.message);
            }
        }

        function showFileLocations() {
            const info = `
Estrutura de ficheiros:

üìÅ vc-demo-project/
‚îú‚îÄ‚îÄ üìÅ data/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ credentials/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ credential-xxx.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ credential-yyy.json
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ presentations/
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ presentation-xxx.json
‚îÇ       ‚îî‚îÄ‚îÄ üìÑ presentation-yyy.json
‚îî‚îÄ‚îÄ üìÅ backups/
    ‚îî‚îÄ‚îÄ üìÅ backup-timestamp/
        ‚îú‚îÄ‚îÄ üìÅ credentials/
        ‚îî‚îÄ‚îÄ üìÅ presentations/

Cada ficheiro cont√©m:
- Dados completos da VC/VP
- Metadata de quando foi salvo
- Preview para listagem r√°pida
    `;
    
    document.getElementById('storageInfo').style.display = 'block';
    document.getElementById('storageInfo').innerHTML = `
        <div class="step">
            <strong>üìÅ Localiza√ß√£o dos Ficheiros</strong>
        </div>
        <pre>${info}</pre>
    `;
}
    </script>
</body>
</html>